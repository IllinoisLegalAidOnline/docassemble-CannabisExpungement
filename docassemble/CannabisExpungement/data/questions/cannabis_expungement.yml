metadata:
  title: Cannabis expungement
  short title: Cannabis expungement
  comment: This program helps you create forms to clear cannabis-related convictions from your criminal record.
  authors:
    - Vivian McNaughton
    - Matt Newsted
---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.ALToolbox:phone-number-validation.yml  
  - docassemble.ILAO:ilao-interview-framework.yml
  - docassemble.ILAO:shared-basic-questions.yml
---
objects:
  - users: ALPeopleList.using(object_type=ALIndividual, there_are_any=True)
  - filing_location: ALAddress
  - convictions: ALPeopleList.using(object_type=ALIndividual, complete_attribute=['complete'], there_are_any=True)
  - convictions[i].alternate_name: ALIndividual
  - states_attorney_address: ALAddress
  - court_list: ALCourtLoader.using(file_name='docassemble.ILAO:data/sources/il_courts.xlsx')
  - alternate_names_list: ALPeopleList.using(object_type=ALIndividual, there_is_another=False)
  - partial_name_list: ALPeopleList.using(object_type=ALIndividual, there_is_another=False)
  - court_house_address: DAObject
  - qualified_convictions: ALPeopleList.using(object_type=ALIndividual, complete_attribute=['complete'], there_are_any=True, there_is_another=False)
---
code: |
  al_form_type = 'existing_case'
  ilao_easy_form_title = "Cannabis expungement"
  ilao_easy_form_url = "https://www.illinoislegalaid.org/legal-information/cannabis-expungement"
  form_name = "Cannabis expungement"
  github_user = 'IllinoisLegalAidOnline'
  github_repo_name = 'docassemble-CannabisExpungement'
  allowed_courts = ['Circuit']
---
# Road map
sections:
  - section_intro: Start
  - section_conviction: Conviction info
  - section_notice: Notice
  - section_filing: Filing
  - section_about_you: About you
  - section_download: Download  
---
# interview order block
mandatory: True
code: |
  nav.set_section('section_intro')
  sees_nav_bar
  how_to_use
  #docs_needed
  accept_terms
  set_progress(5)
  about_expungement
  eligibility
  more_eligibility
  users[0].name.first  
  
  nav.set_section('section_conviction')
  set_progress(20)
  if filing_location.county == "Cook":
    cook_district
  alternate_name_list_starts_false
  convictions_intro
  #convictions_count_code
  convictions.gather()
  #if convictions.number_gathered() == 1:
  #  if convictions[0].other_name_check == False:
  #    convictions[0].alternate_name.name.first
  #else:
  #  if need_a_name_list_check == True:
  #    name_limit = 0
  #    for person in convictions:
  #      if name_limit < 6:
  #        if person.qualified == True:
  #          if person.other_name_check == False:
  #            name_limit += 1
  #            person.alternate_name.name.first
  #        else:
  #          person.unqualified_name_flagging
  #    if name_limit > 7:
  #      too_many_names  
  #list_those_names
  
  nav.set_section('section_notice')
  set_progress(40)
  providing_notice
  if hearing_date_check == True:
    hearing_date
    hearing_courtroom
  set_progress(60)
  
  states_attorney_address.address
  
  nav.set_section('section_filing')
  new_number_check
  if fee_waiver_check == True:
    fee_waiver_info
  
  nav.set_section('section_about_you')
  missed_opportunities
  users[0].birthdate
  set_progress(80)
  users[0].race
  users[0].gender
  users[0].address.address
  users[0].has_email_address
  
  e_signature
  
  nav.set_section('section_download')
  filter_out_those_convictions
  a_little_more_logic
  court_house_address
  set_progress(100)
  list_those_names
  #counting_is_fun
  get_docs_screen
---
#This is the convictions gather code block
code: |
  #reconsideration_containment = True
  #if qualified_count_check < 3:
  convictions[i].date
  #After asking for the conviction date, the program goes through questions checking that the conviction qualifies for expungement. Each line that ends in "_dq" is pulling up a continue button field and then going to the "there_is_another" question.
  if convictions[i].type == "other":
    convictions[i].invalid_type_dq

  elif convictions[i].same_case_check == True:
    convictions[i].same_case_dq

  #The path splits here, but is mostly the same. If probation_check is true, there is an extra qualification question to ask. AFter that question, this path is the same as the other path. So why are they separated for so long? Well, this code block uses elif conditions so the "_dq" flags can be continue button fields instead of kickout screens. There is probably a more elegant way to handle it, but this does at least work.
  elif convictions[i].probation_check == True:
    if convictions[i].probation_complete == True:
      convictions[i].probation_dq

    elif convictions[i].sentence_check == True:
      convictions[i].sentence_dq

    elif convictions[i].conditions_check == False:
      convictions[i].conditions_dq

    else:  
      #Path A's post-qualification questions
      convictions[i].conviction_eligible
      convictions[i].case_number 
      convictions[i].arrest_date

  #Per the above comment, this is the other path branch that is largely the same as the first, it just has one fewer qualification question to ask. Any change made to the gather loop's interview path may need to be made twice as a result. My apologies. Maybe I will smooth this out.
  elif convictions[i].sentence_check == True:
    convictions[i].sentence_dq

  elif convictions[i].conditions_check == False:
    convictions[i].conditions_dq

  else:  
    #Path B's post-qualification questions
    convictions[i].conviction_eligible
    convictions[i].case_number 
    convictions[i].arrest_date

  #This seciton of the gather code block deals with alternate names. Currently, due to template space, the program only allows for six alternate names.
  if i < 6:
    #This section for when i is less than 6 exists so the program can run less code when there is no possibility the user has maxed out the alternate name list. If there were no limit to the amount of alternate names, this whole section would be little more than the next 3 lines.
    if convictions[i].qualified == True:
      if convictions[i].other_name_check == False:
        convictions[i].alternate_name.name.first
  else:
    #Now the user has entered enough convictions we have to make sure they haven't entered too many names! Creating a list of alternate names requires iterating through the convictions list, which is tricky given that this code block is the gathering code for that list! Consequently, here and elsewhere in the program we use a while loop. quick_name_count tracks how many convictions have alternate names, name_counter_iteration increments each pass through the loop. The loop stops once it has checked every conviction before the one currently being gathered.
    quick_name_count = 0
    name_count_iteration = 0
    while name_count_iteration < i:
      if convictions[name_count_iteration].qualified == True:
        if convictions[name_count_iteration].other_name_check == False:
          quick_name_count += 1
      name_count_iteration += 1
    #This if statement asks if there is an alternate name if the user hasn't already entered 6 alternate names. The corresponding else statement tells the user they have already entered as many names as the program will accept.
    if convictions[name_count_iteration].qualified == True:
      if quick_name_count < 6:
        if convictions[i].other_name_check == False:
          convictions[i].alternate_name.name.first
      else:
        too_many_names
        
  #This variable is used to keep track of whether a conviction qualifies for expungement. For reasons discussed in the code block that defines it, this variable is not defined by the gather code block.
  convictions[i].qualified
  #reconsideration_containment = False
  #counting_is_fun
  #if qualified_count_check > 1:
  #  max_conviction_note
  #  convictions.there_is_another = False
  
  #The templates max out at 36 qualified convictions, but unqualified convictions don't appear on the forms at all. Therefore, we can allow the user to enter more than 36 convictions if some of the first 36 do not qualify. This calculation isn't necessary until the user enters a 36th conviction. At that point, at the end of each iteration through the gather loop this code runs a check to see if there have been 36 qualified convictions entered.
  if i >= 35:
    #quick_qualify_count tracks how many convictions qualify, quick_cycle_fun increments with each iteration of the while loop. The while loop stops once it has checked every conviction entered prior to the current one.
    quick_qualify_count = 0
    quick_cycle_fun = 0
    while quick_cycle_fun <= i:
      if convictions[quick_cycle_fun].qualified == True:
        quick_qualify_count += 1
      quick_cycle_fun += 1
     #This if statement ends the iterations of the gather loop if there have been 36 qualified convictions entered.
    if quick_qualify_count >= 36:
      max_conviction_note
      convictions.there_is_another = False
  
  convictions[i].complete = True
---
#This code block sets a conviction's other_name_check variable to True if it does not qualify for expungement. This block should be redundant: if statements elsewhere in the yml involving the other_name_check variable should be nested within an if statement "if convictions[i].qualified == True".
sets:
  - convictions[i].unqualified_name_flagging
depends on:
  - convictions[i].qualified
code: |
  if convictions[i].qualified == False:
    convictions[i].other_name_check = True
  convictions[i].unqualified_name_flagging = True
---
#This code block sets a variable that keeps track of whether each conviction qualifies for expungement or not. This variable is referenced in a few other sections of the yml. It should more or less mirror the eligibility questions in the convictions gather loop. It is separated in order to make the "qualified" variable update if the user edits their answers and causes a conviction to qualify or no longer qualify.
sets:
  - convictions[i].qualified
depends on:
  - convictions[i].type
  - convictions[i].same_case_check
  - convictions[i].probation_check
  - convictions[i].probation_complete
  - convictions[i].sentence_check
  - convictions[i].conditions_check
code: |
    if convictions[i].type == "other":
      convictions[i].qualified = False
    elif convictions[i].same_case_check == True:
      convictions[i].qualified = False
    elif convictions[i].probation_check == True:
      if convictions[i].probation_complete == True:
        convictions[i].qualified = False
      elif convictions[i].sentence_check == True:
        convictions[i].qualified = False
      elif convictions[i].conditions_check == False:
        convictions[i].qualified = False
      else:
        convictions[i].qualified = True
    elif convictions[i].sentence_check == True:
      convictions[i].qualified = False
    elif convictions[i].conditions_check == False:
      convictions[i].qualified = False
    else:
      convictions[i].qualified = True
---
#This is known as a list comprehension. It creates a list that is just every item in another list that meets a given condition. qualifed_convictions is created here; it has the same contents as the convictions list except it does not include convictions that cannot be expunged. The qualified_convictions list is used in the template. reconsider must be set to True to ensure that the qualified_convictions list will be updated if the convictions list is changed. filter_out_those_convictions is just a variable used to activate this code block.
reconsider: True
code: |
  qualified_convictions = [conviction for conviction in convictions if conviction.qualified == True]
  filter_out_those_convictions = True
---
#code: |
#  qualified_count = 0
#  name_count = 0
#  convictions_count_code = True
---
id: welcome
question: |
  Cannabis expungement
subquestion: |
  Welcome to Illinois Legal Aid Online's **Cannabis expungement** Easy Form.

  This program will help you create forms to clear cannabis-related convictions from your criminal record.
  
  The forms you make with this program can only be used in Illinois.
  
  To learn more, read ILAO's article about [**expunging cannabis offenses**](https://www.illinoislegalaid.org/legal-information/i-have-cannabis-arrest-or-conviction).
field: sees_nav_bar
---
id: about expungement
continue button field: about_expungement
question: |
  About cannabis expungement
subquestion: |
  Some cannabis convictions in Illinois from before June 25, 2019 can be expunged.  To ‘expunge’ means to erase the police and court records of the conviction.

  To vacate the cannabis conviction means to set aside the finding of guilt, as if it did not happen. To vacate and expunge an eligible cannabis conviction, a person must file a motion with the court.

  This program will create a *Motion to Vacate & Expunge Eligible Cannabis Convictions* that will include any of your eligible cannabis convictions. If you have any non-eligible convictions or arrests that did not end in conviction, you may be able to expunge them using ILAO's [**Criminal record expungement Easy Form**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request).
  
  To learn more about the types of cannabis convictions that can be expunged, read ILAO's article about [**clearing cannabis convictions from a criminal record**](https://www.illinoislegalaid.org/new-leaf/weed-legal-now-can-i-clear-my-record).
---
id: instructions
continue button field: how_to_use
question: |
  Instructions
subquestion: |
  To use this program you will need: 

  * Court Dispositions for all of your criminal cases,
  * Your Illinois State Police RAP Sheet, and
  * If you had arrests or charges in Chicago, your Chicago Police RAP Sheet.
  
  ${collapse_template(find_information_help)}
  
  Set aside 10 to 20 minutes to finish this program. You can log in and save your work to return to later. 
 
  ${ collapse_template(help_example) }  

  Click on **{green words}** to learn what they mean. Some pages have a question mark in a circle ${ fa_icon("question-circle", color_css="#0dcaf0" ) } that helps explain things.
---
template: help_example
subject: |
  **You can click sections like this to show more information.**
content: |  
  This is an example of help. Click again to hide.
---
id: documents needed
continue button field: docs_needed
question: |
  Instructions
subquestion: |
  To use this program you will need: 

  * Court Dispositions for all of your criminal cases,
  * Your Illinois State Police RAP Sheet, and
  * If you had arrests or charges in Chicago, your Chicago Police RAP Sheet.
  
  ${collapse_template(find_information_help)}
---
template: find_information_help
subject: |
  **Where can I find these documents?**
content: |
  **Court Dispositions**

  You can get court dispositions for your court cases from the courthouse. Ask the Circuit Clerk for copies of the court dispositions. You may be able to use the courthouse's public computer to look them up. There may be a fee to get copies or print out your court dispositions. Find your [**Circuit Clerk's website**](https://www.illinoiscourts.gov/courts/circuit-court/circuit-court-clerks/).

  **Illinois State Police RAP Sheet**

  You can get an Illinois State Police RAP sheet to make sure you know all your arrests, charges, and convictions. You will need to complete a request form and pay a fee. There may be a waiting period before you get your information.

  Find conviction information request forms at the [**Illinois State Police website**](https://isp.illinois.gov/BureauOfIdentification/MyRecord) or by contacting:

  Illinois State Police   
  Bureau of Identification   
  260 North Chicago Street   
  Joliet, Illinois 60432   
  (815) 740-5160   

  **Chicago Police RAP Sheet**

  You can get a RAP sheet from the Chicago Police Department (CPD) if you were arrested in Chicago. There will be a fee, and you will have to wait around a week before you can pick it up.

  The Chicago Police Department can be found at:

  Chicago Police Headquarters  
  3510 S. Michigan Ave.  
  Chicago, Illinois 60653  
  (312) 745-5508  

  Ask for a copy of your Illinois State Police Statewide Criminal History Transcript. The Chicago Police will provide your state record at no extra cost.

  To learn more, read ILAO's article about [**how to get copies of your criminal records**](https://www.illinoislegalaid.org/legal-information/how-get-copies-your-criminal-records).
---
id: eligibility
continue button field: eligibility
question: |
  Eligibility
subquestion: |
  Not all cannabis convictions can be expunged using these forms. Only misdemeanor and Class 4 felony convictions for Sections 4 and 5 of the [**Cannabis Control Act**](https://www.ilga.gov/legislation/ilcs/ilcs3.asp?ActID=1937&ChapterID=53) are eligible.
  
   ${collapse_template(which_convictions_qualify)}

  For any other cannabis-related convictions, you may be able to use the [**Criminal Record Expungement or Sealing program**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request).
---
template: which_convictions_qualify
subject: |
  **Which cannabis convictions can be expunged?**
content: |
  The following list of charges and amounts is a guide for cannabis convictions that may be vacated and expunged using these forms.

  * **Possession of Cannabis** (all dates before 6/25/19), 500 grams or less
  * **Attempted Possession of Cannabis** (between 8/15/97 and 6/24/19), 2000 grams or less
  * **Attempted Possession of Cannabis** (prior to 8/15/97), Any amount
  * **Manufacture / Delivery of Cannabis** (between 9/24/83 and 6/24/19) ,30 grams or less
  * **Attempted Manufacture / Delivery of Cannabis** (between 9/24/83 and 6/24/19), 500 grams or less
---
id: more eligibility
continue button field: more_eligibility
question: |
  About other convictions
subquestion: |
  If you have been convicted of Trafficking (Section 5.1) or Delivery of Cannabis on School Grounds (Section 5.2) you are not eligible to vacate and expunge those records.

  However, they may be eligible for expungement using the regular petition process.
  
  You **can not** use this program to expunge the records of a case where:
  
  * You were found not guilty,
  * The case was dismissed,
  * You were arrested but were never changed with a crime,
  * You were pardoned by the governor, or
  * The court cancelled or reversed your conviction.

  Use the [**Criminal records expungement or sealing request**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request) for those records.
---
id: filing county
question: |
  Which county are you filing your motion in?
subquestion: |
  You need to file in the county where you were convicted.
  
  ${collapse_template(multiple_counties)}
fields:
  - no label: filing_location.trial_court_index
    code: |
      ilao_court_county_lookup(court_list)
validation code: |
  if filing_location.trial_court_index == "-1":
    trial_court = court_list.as_court('trial_court', 15)
  else:
    trial_court = court_list.as_court('trial_court', filing_location.trial_court_index)
---
#Could we change this? Could Docassemble handle multiple counties?
template: multiple_counties
subject: |
  **What if I have convictions in more than one county?**
content: |
  While this program creates a *Motion to Vacate & Expunge* that can expunge more than one conviction, they must be from the same county.
  
  If you have convictions in more than one county, you will have to use this program more than once. 
---
code: |
  filing_location.trial_court_index
  filing_location.county = trial_court.address.county
---
id: offense type
question: |
  What type of cannabis conviction is the ${convictions[i].date} conviction?
subquestion: |
  ${collapse_template(finding_type)}
field: convictions[i].type
choices:
  - Misdemeanor: misdemeanor
  - Class 4 felony: felony
  - Other: other
---
template: finding_type
subject: |
  **How can I find what type my conviction is?**
content: |
  Look at your court dispositions and RAP sheets for "Type" and "Class" of the offense.

  * An 'F' under Type means the offense was a felony. An 'M' means the offense was a misdemeanor.
  * If it was a felony, the number under Class refers to the class of felony.
  
  [FILE ClassAndType.png]
---
id: invalid type disqualification
continue button field: convictions[i].invalid_type_dq
question: |
  ${convictions[i].date} conviction cannot be expunged with this program
subquestion: |
  Only misdemeanor cannabis offenses and class 4 felony cannabis offenses can be expunged with this program. You may be able to expunge other offenses using ILAO's [**Criminal record expungement Easy Form**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request).
  
  You can talk with a lawyer to discuss your options. Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
  
  % if i == 0:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge a different conviction.
  % elif i == 1:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the conviction you have already entered.
  % else:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the convictions you have already entered.
  % endif
---
id: convictions intro
continue button field: convictions_intro
question: |
  Convictions
subquestion: |
  The next screens will ask about your cannabis convictions. They will check if the convictions are eligible and ask for some details about them.
  
  This program might not work for some cannabis convictions, but there might be other ways to clear them from your record. You may want to talk to a lawyer about these convictions. Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area. 
---
id: max conviction note
continue button field: max_conviction_note
question: |
  Maximum convictions
subquestion: |
  This program only creates forms to expunge 36 convictions. If you have more convictions you need to expunge, you may want to use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
---
id: conviction date
question: |
  % if i == 0:
  When were you convicted of the first offense you want to expunge?
  % else:
  When were you convicted of your ${ordinal(i)} offense?
  % endif
subquestion: |
  Only convictions before June 25, 2019 can be expunged using this program.
  
  % if i > 0:
  So far you have entered information for convictions on these dates: ${comma_and_list(convictions.complete_elements().full_names())}.
  % endif
fields:
  - Date: convictions[i].date
    datatype: date
    max: '6/24/2019'
    min: '1/1/1901'
---
id: same case multiple convictions check
question: |
  Were you convicted of any additional counts in the same case as your ${convictions[i].date} conviction?
subquestion: |
  If you were also convicted in the same case on a separate count (cannabis-related or otherwise) that is not eligible to be vacated, the court will not vacate and expunge the case.

  However, it may be eligible for expungement or sealing using the [**Criminal records expungement Easy Form**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request).
fields:
  - no label: convictions[i].same_case_check
    datatype: yesnoradio
---
id: same case multiple convictions disqualification
continue button field: convictions[i].same_case_dq
question: |
  ${convictions[i].date} conviction cannot be expunged with this program
subquestion: |
  Since you were convicted in the same case on a separate count that is not eligible to be vacated, the court will not vacate and expunge this conviction.
  
  However, it may be eligible for expungement or sealing using the [**Criminal records expungement Easy Form**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request).
  
  You can talk with a lawyer to discuss your options. Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
  
  % if i == 0:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge a different conviction.
  % elif i == 1:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the conviction you have already entered.
  % else:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the convictions you have already entered.
  % endif
---
id: any probation check
question: |
  Did you receive Court Supervision or Qualified Probation for your ${convictions[i].date} conviction?
subquestion: |
  Qualified probation may also be called 410, 710, 1410, or TASC probation. 
  
  A court may give out qualified probation if it determines the arrest was a result of drug addiction. The court disposition will say if you got this type of probation.
fields:
  - no label: convictions[i].probation_check
    datatype: yesnoradio
---
id: probation complete check
question: |
  Did you successfully complete your Court Supervision or Qualified Probation for your ${convictions[i].date} conviction?
fields:
  - no label: convictions[i].probation_complete
    datatype: yesnoradio
---
id: sentence check
question: |
  Are you still serving the sentence for your ${convictions[i].date} conviction?
fields:
  - no label: convictions[i].sentence_check
    datatype: yesnoradio
---
#The wording of this question seems off? This is how it was phrased in A2J, but shouldn't it be "conditions of your release" or something similar?
id: conditions check
question: |
  Have you completed all conditions of your ${convictions[i].date} conviction?
subquestion: |
  Some sentences of probation or conditional discharge may require you to complete additional conditions before your sentence is discharged.

  For example, you may have been ordered to do community service, undergo treatment or counseling, or be monitored.
fields:
  - no label: convictions[i].conditions_check
    datatype: yesnoradio
---
#The following kickouts all occurr within the gather loop for the convictions. It seems like poor design to have the kickout event recur like that. Is there a way to add a button that just restarts the iteration?
---
id: conditions disqualification
continue button field: convictions[i].conditions_dq
question: |
  ${convictions[i].date} conviction cannot be expunged with this program
subquestion: |
  A conviction cannot be expunged if you have not completed all conditions for it.
  
  You can talk with a lawyer to discuss your options. Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
  
  % if i == 0:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge a different conviction.
  % elif i == 1:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the conviction you have already entered.
  % else:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the convictions you have already entered.
  % endif
---
id: active sentence disqualfication
continue button field: convictions[i].sentence_dq
question: |
  ${convictions[i].date} conviction cannot be expunged with this program
subquestion: |
  A conviction cannot be expunged if you are still serving your sentence for it.
  
  You can talk with a lawyer to discuss your options. Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
  
  % if i == 0:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge a different conviction.
  % elif i == 1:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the conviction you have already entered.
  % else:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the convictions you have already entered.
  % endif
---
id: probation kickout
continue button field: convictions[i].probation_dq
question: |
  The ${convictions[i].date} conviction is not eligible to be expunged.
subquestion: |
  If you successfully completed your Court Supervision or Qualified probation, the conviction is not eligible for a motion to vacate and expunge. However, it is eligible for expungement using the regular [**criminal records expungement request**](https://www.illinoislegalaid.org/legal-information/criminal-record-expungement-or-sealing-request).
  
  You can talk with a lawyer to discuss your options. Use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
  
  % if i == 0:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge a different conviction.
  % elif i == 1:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the conviction you have already entered.
  % else:
  Click **Back** if you made a mistake. Click **Next** if you would like to expunge another conviction or expunge the convictions you have already entered.
  % endif
---
id: conviction eligibile
continue button field: convictions[i].conviction_eligible
question: |
  Good news!
subquestion: |
  The ${convictions[i].date} conviction is eligible to be expunged using this form.

  **Note:** even though this conviction is eligible to be expunged, it is still up to the judge to decide if it will be.
---
#Where does the municipal case number get used in the LHI verison?
id: conviction case number
question: |
  What is the court case number of your ${convictions[i].date} conviction?
subquestion: |
  If there is a municipal case number, you should enter that as well. Not all cases will have a municipal case number.
  
  % if convictions[i].type == "felony":
  The municipal number usually has the same Central Booking (CB) number as the felony case.
  % else:
  The municipal number usually has the same Central Booking (CB) number as the misdemeanor case.
  % endif
  
  ${collapse_template(case_number_help)}
fields:
  - Case number: convictions[i].case_number
    maxlength: 20
  - Municipal number: convictions[i].municipal_number
    maxlength: 20
    help: |
      Not all cases have a municipal number.
    required: False
---
template: case_number_help
subject: |
  **Where can I find this?**
content: |
  The case number can be found on your RAP sheet. It might also be in the court record or in an ISP report.

  The Municipal case number ("muni #") is not always listed on the RAP sheet or ISP report. Some cases do not have municipal numbers. The court disposition for the felony case might show the municipal number as the “related case.” Ask the Circuit Clerk how to find this information or use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find a lawyer.
  
  [FILE CaseNumber.png]
---
id: arrest info
question: |
  Arrest information
subquestion: |
  Enter arrest information about the ${convictions[i].date} conviction.
  
  ${collapse_template(find_agency)}
fields:
  - Arrest date: convictions[i].arrest_date
    datatype: date
    max: ${convictions[i].date}
    min: '1/1/1901'
  - Agency: convictions[i].agency
    maxlength: 35
    help: |
      This is the law enforcement agency that arrested you. This is often a police department. 
---
template: find_agency
subject: |
  **Where can I find the arresting agency?**
content: |
  This can be found on your RAP sheet.
  
  [FILE ArrestingAgency.png]
---
id: user name
question:  |
  What is your name?
subquestion: |
  ${collapse_template(multiple_names_help)}
fields:
  - First name: users[0].name.first
  - Middle name: users[0].name.middle
    required: False
  - Last name: users[0].name.last
  - Suffix: users[0].name.suffix
    code: |
      name_suffix()
    required: False  
---
template: multiple_names_help
subject: |
  **What if I was convicted under a different name?**
content: |
  For this question, you should enter your current legal name.
  
  You can list other names you were convicted under on another screen.
---
id: need a name list check
question: |
  Were you convicted under a name other than ${users[0].name.full(middle='full')} for any of your convictions?
field: need_a_name_list_check
choices:
  - Yes, I was convicted under multiple names.: True
  - No, I was only convicted under the name ${users[0].name.full(middle='full')}.: False
---
sets:
  - convictions[i].other_name_check
id: other name check
question: |
  % if any_alternate_names_yet == False:
  Was your name listed as ${users[0].name.full(middle='full')} for your ${convictions[i].date} conviction?
  % else:
  Was your name listed as ${users[0].name.full(middle='full')} or one of the other names you have listed for your ${convictions[i].date} conviction?
  % endif
subquestion: |
  % if any_alternate_names_yet == True:
  So far you have listed these other names: ${comma_and_list(partial_name_list)}.
  % endif
field: convictions[i].other_name_check
choices:
  - Yes: True
  - No, I was convicted under a different name.: False
---
#reconsider: True
#code: |
#  any_alternate_names_yet = False
#  what_is_the_number_gathered = convictions.number_gathered()
#  what_is_the_number_gathered -= 1
#  if convictions.number_gathered() <= 1:
#    any_alternate_names_yet = False
#  else:
#    alt_name_counter = 0
#    while alt_name_counter < what_is_the_number_gathered:
#      if convictions[alt_name_counter].other_name_check == False:
#        any_alternate_names_yet = True
---
id: conviction name
question: |
  What name was used for you in the ${convictions[i].date} conviction?
subquestion: |
  % if any_alternate_names_yet == True:
  So far you have entered the names ${comma_and_list(partial_name_list)}.
  % endif
fields:
  - First: convictions[i].alternate_name.name.first
  - Middle: convictions[i].alternate_name.name.middle
    required: False
  - Last: convictions[i].alternate_name.name.last
  - Suffix: convictions[i].alternate_name.name.suffix
    code: |
      name_suffix()
    required: False
validation code: |
  partial_name_list.append(convictions[i].alternate_name.name.full(middle='full'))
  any_alternate_names_yet = True
---
#partial_name_list is a list used in subquestions to list out the names the user has entered so far. any_alternate_names_yet is a true/false variable that is flagged to True when an alternate name is entered. This code block provides the initial states for both. alternate_name_list_starts_false is just used to activate this code block. This code block should not have a depends on section or reconsider set to True; it should only be run once.
code: |
  any_alternate_names_yet = False
  partial_name_list.clear()
  alternate_name_list_starts_false = True
---
id: too many names
continue button field: too_many_names
question: |
  About other names used
subquestion: |
  The *Motion to Vacate and Expunge* has limited space for other names.
  
  These other names will appear on your *Motion*: ${comma_and_list(partial_name_list)}.
    
  If you have been convicted under more names than those you have already listed, you may need to create multiple motions or use **[Get Legal Help](https://www.illinoislegalaid.org/get-legal-help)** to find free or low-cost legal services in your area.
---
#Since convictions is an ALPeopleList each item needs name.first defined. I set name.first to the date for use in "So far you have entered convictions from these dates."
code: |
  convictions[i].name.first = word(convictions[i].date)
---
id: any other convictions
question: |
  Is there another conviction you want to include in your motion?
subquestion: |
  You can only include convictions that happened in ${end_in_county(filing_location.county)}. If you want to expunge convictions that happened in another county, you will have to go through this program again.
  
   % if i > 0:
  So far you have entered information for convictions on these dates: ${comma_and_list(convictions.complete_elements().full_names())}.
  % endif
fields:
  - no label: convictions.there_is_another
    datatype: yesnoradio
---
id: providing notice
continue button field: providing_notice
question: |
  Providing notice
subquestion: |
  You must tell the State's Attorney in ${end_in_county(filing_location.county)} about your *Motion* and your court hearing. This is done by a form called a *Notice of Motion to Vacate & Expunge Eligible Cannabis Convictions*.

  The next questions will help fill out this *Notice*.

  The court clerk will deliver a copy of your *Motion* and the *Notice* to the State's Attorney.
---
id: hearing date check
question: |
  Do you have a court hearing scheduled to expunge these convictions?
field: hearing_date_check
choices:
  - Yes: True
  - No, I do not yet have a hearing scheduled.: False 
---
id: hearing date time
question: |
  When and where is your court hearing?
fields:
  - Date: hearing_date
    datatype: date
    min: ${ today().format("yyyy-MM-dd") }
    max: ${ today().plus(years=2) }
  - Time: hearing_time
    datatype: time
  - note: |
      If you have not been assigned a courtroom yet, you can leave this next field blank.
  - Courtroom: hearing_courtroom
    required: False
    maxlength: 20
---
id: cook county courthouse
question: |
  Which Cook County courthouse will you file in?
subquestion: |
  You can file your forms in any Cook County location.

  The Daley Center and the George N. Leighton Criminal Court Building have the most experience with expunging cannabis convictions.
  
  ${collapse_template(cook_district_help)}
field: cook_district
choices:
  - First Municipal District, Daley Center, 50 W. Washington Street, Chicago: 15
    help: |
      The First Municipal District covers the **City of Chicago**. 
  - Second Municipal District, 5600 Old Orchard Road, Skokie: 16
    help: |
      The Second Municipal District covers the **northern suburbs of Cook County**. It includes:
      
      * Deerfield
      * Des Plaines
      * Evanston
      * Glencoe
      * Glenview
      * Golf
      * Kenilworth
      * Lincolnwood
      * Maine (not within Rosemont)
      * Morton Grove
      * New Trier
      * Niles
      * Northbrook
      * Northfield (not within Prospect Heights)
      * Park Ridge
      * Skokie
      * Wilmette
      * Winnetka
      * Wheeling (within Des Plaines)
  - Third Municipal District, 2121 Euclid Avenue, Rolling Meadows: 17
    help: |
      The Third Municipal District covers the **northwestern suburbs of Cook County**. It includes:

      * Arlington Heights
      * Barrington
      * Barrington Hills
      * Bartlett
      * Bensenville
      * Buffalo Grove
      * East Dundee
      * Elgin
      * Elk Grove
      * Elk Grove Village
      * Hanover
      * Hanover Park
      * Harwood Heights
      * Hoffman Estates
      * Inverness
      * Leyden (within Rosemont and Schiller Park)
      * Maine (within Rosemont)
      * Mount Prospect
      * Norridge
      * Northfield (within Prospect Heights)
      * Norwood Park (not within Chicago)
      * Palatine
      * Prospect Heights
      * Rolling Meadows
      * Roselle
      * Rosemont
      * Schaumburg
      * Schiller Park
      * South Barrington
      * Streamwood
      * Wheeling (not within Des Plaines)    
  - Fourth Municipal District, 1500 Maybrook Drive, Maywood: 18
    help: |
      The Fourth Municipal District covers the **western suburbs of Cook County**. It includes:
      
      * Bellwood
      * Berkeley
      * Berwyn
      * Broadview
      * Brookfield
      * Cicero
      * Elmwood Park
      * Forest Park
      * Franklin Park
      * Hillside
      * La Grange Park
      * Leyden (not within Rosemont and Schiller Park)
      * Maywood
      * Melrose Park
      * Northlake
      * North Riverside
      * Oak Park
      * Proviso
      * River Forest
      * River Grove
      * Riverside
      * Stone Park
      * Westchester  
  - Fifth Municipal District, 10220 S. 76th Avenue, Bridgeview: 19
    help: |
      The Fifth Municipal District covers the **southwestern suburbs of Cook County**. It includes:
      
      * Alsip
      * Bedford Park
      * Bridgeview
      * Burbank
      * Burr Ridge
      * Chicago Ridge
      * Crestwood
      * Countryside
      * Evergreen Park
      * Forest View
      * Hickory Hills
      * Hinsdale
      * Hodgkins
      * Hometown
      * Indian Head Park
      * Justice
      * La Grange
      * Lemont
      * Lyons
      * McCook
      * Merrionette Park
      * Oak Forest
      * Oak Lawn
      * Orland Hills
      * Orland Park
      * Palos
      * Palos Heights
      * Palos Hills
      * Palos Park
      * Stickney
      * Summit
      * Tinley Park
      * Western Springs
      * Willow Springs
      * Woodridge
      * Worth
  - Sixth Municipal District, 16501 South Kedzie Parkway, Markham: 20
    help: |
      The Sixth Municipal District covers the **southern suburbs of Cook County**. It includes:
      
      * Bloom
      * Blue Island
      * Bremen
      * Burnham
      * Calumet
      * Calumet City
      * Calumet Park
      * Chicago Heights
      * Country Club Hills
      * Crete
      * Dixmoor
      * Dolton
      * East Hazel Crest
      * Flossmoor
      * Ford Heights
      * Glenwood
      * Harvey
      * Hazel Crest
      * Homewood
      * Lansing
      * Lynwood
      * Markham
      * Matteson
      * Midlothian
      * Olympia Fields
      * Park Forest
      * Phoenix
      * Posen
      * Rich
      * Richton Park
      * Riverdale
      * Robbins
      * Sauk Village
      * South Chicago Heights
      * South Holland
      * Steger
      * Thornton  
  - George N. Leighton Criminal Court Building, 2600 S. California Avenue, Chicago: 22
    help: |
      The George N. Leighton Criminal Court is a Circuit Court of Cook County's County Department Criminal Division.
---
 #  if cook_district == 15:
 #    court_house_address = "Daley Center, 50 W. Washington Street, Chicago, IL 60602"
 #  elif cook_district == 16:
 #    court_house_address = "5600 Old Orchard Road, Skokie, IL 60077"
 #  elif cook_district == 17:
 #    court_house_address = "2121 Euclid Avenue, Rolling Meadows, IL 60008"
 #  elif cook_district == 18:
 #    court_house_address = "1500 Maybrook Drive, Maywood, IL 60153"
 #  elif cook_district == 19:
 #    court_house_address = "10220 S. 76th Avenue, Bridgeview, IL 60455"
 #  elif cook_district == 20:
 #    court_house_address = "16501 South Kedzie Parkway, Markham, IL 60428"
 #  elif cook_district == 22:
 #    court_house_address = "George N. Leighton Criminal Court Building, 2600 S. California Avenue, Chicago, IL 60608"
---
template: cook_district_help
subject: |
  **What if I am not sure?**
content: |  
  Visit **[Illinois Court Help](https://www.ilcourthelp.gov/)**, or you can call or text (833) 411-1121 for assistance.
---
#I think there is a better way to handle this.
depends on:
  - cook_district
  - filing_location.trial_court_index
code: |

  if filing_location.trial_court_index == "-1":
    trial_court = court_list.as_court('trial_court', cook_district)

  else:
    trial_court = court_list.as_court('trial_court', filing_location.trial_court_index)

    
  court_name = str(trial_court.name)
  court_street_address = str(trial_court.address.address)
  court_city = str(trial_court.address.city)
  court_state = str(trial_court.address.state)
  court_zip = str(trial_court.address.zip)
  court_house_address = court_name + ", " + court_street_address + ", " + court_city + ", " + court_state + " " + court_zip
---
#id: hearing courtroom
#question: |
#  What courtroom have you been assigned?
#subquestion: |
#  If you have not been assigned a courtroom yet, you can leave this blank.
#fields: 
#  - Courtroom: hearing_courtroom
#    required: False
---
#Will need to add information for how to find this info, at least for the most populous counties.
id: states attorney address
question: |
  What is the address of ${end_in_county(filing_location.county)}'s State's Attorney?
subquestion: |
  You should be able to find this address on the Internet. Click [**Illinois ${end_in_county(filing_location.county)} state's attorney address**](https://www.google.com/search?q=${filing_location.county}+county+illinois+state%27s+attorney%27s+office) to search for it using Google.
  
  If you do not know this now, you can add it to your forms later. You will need to add the State's Attorney's address before you file your forms.
fields:
  - Street address: states_attorney_address.address
    address autocomplete: True
    required: False
  - Address line 2: states_attorney_address.unit
    required: False
  - City: states_attorney_address.city
    required: False
  - State: states_attorney_address.state
    required: False
    code: |
      states_list() 
  - ZIP code: states_attorney_address.zip
    required: False
---
id: new case number
question: |
  Did the clerk give you a new case number for this expungement case?
fields:
  - no label: new_number_check
    datatype: yesnoradio
  - New case number: new_case_number
    show if: 
      variable: new_number_check
      is: True
    maxlength: 20
---
id: fee waiver check
question: |
  Do you want to ask the court clerk to waive your fees?
subquestion: |
  Courts often ask that you pay money when you file forms. However, you have the option to request that the court not make you pay fees. You can use ILAO's [**Fee waiver Easy Form**](https://www.illinoislegalaid.org/legal-information/fee-waiver) to fill out your fee waiver request.
  
  If you click **Yes**, you will have to include a fee waiver request with your cannabis expungement forms. 
fields:
  - no label: fee_waiver_check
    datatype: yesnoradio
---
id: fee waiver info
continue button field: fee_waiver_info
question: |
  Fee waiver
subquestion: |
  You can use ILAO's [**Fee waiver Easy Form**](https://www.illinoislegalaid.org/legal-information/fee-waiver) to fill out your fee waiver request.
  
  You should include your request for fee waiver with your cannabis expungement forms when you file them with the court.
---
id: user birthdate
question: |
  When were you born?
fields:
  - Date of birth: users[0].birthdate
    datatype: BirthDate
    alMax: '6/25/2010'
---
id: user race
question: |
  Which race best describes you?
subquestion: |
  ${collapse_template(why_enter_race)}
fields:
  - Race: users[0].race
    input type: radio
    choices:
      - Asian: Asian
      - Black: Black
      - Hispanic: Hispanic
      - Latino: Latino
      - Middle Eastern: Middle Eastern 
      - Native American: Native American
      - Native Hawaiian: Native Hawaiian
      - North African: North African
      - Pacific Islander: Pacific Islander
      - White: White
      - 2 or more races: Multiracial
      - Other: Other
  - Other: users[0].other_race
    maxlength: 20
    show if: 
      variable: users[0].race
      is: "Other"    
---
template: why_enter_race
subject: |
  **Why do I need to enter my race?**
content: |
  The state of Illinois uses race for identification purposes.
---
#Does this need to correspond to the gender listed on the arrest or conviction? On the form of id the user will use at the hearing? Question for a SME
id: user gender
question: |
  What is your legal gender?
subquestion: |
  ${collapse_template(intersex_trans_help)}
fields:
  - Gender: users[0].gender
    input type: radio
    choices:
      - Male
      - Female
      - Other
  - Other: users[0].other_gender
    maxlength: 20
    show if: 
      variable: users[0].gender
      is: "Other"  
---
template: intersex_trans_help
subject: |
  **What if I am intersex or transgender?**
content: |
  DEVELOPER NOTE: Consult a SME on this subject. Does the answer need to correspond to the gender listed on the arrest or conviction? On the form of id the user will use at the hearing?
---
id: user address
question: |
  What is your address?
fields:
  - Street address: users[0].address.address
    address autocomplete: True
  - Address line 2: users[0].address.unit
    required: False
  - City: users[0].address.city
  - State: users[0].address.state
    code: |
      states_list() 
  - ZIP code: users[0].address.zip
---
id: your contact information
question: |
  What is your contact information?
subquestion: |
  ${ collapse_template(contact_info_help) }  
fields:  
  - Phone number: users[0].phone_number
    datatype: al_international_phone
    required: False
  - label: |
      I have an email address
    field: users[0].has_email_address      
    datatype: yesnoradio
  - note: |
      This email address will appear on your court forms. Be sure to check 
      this email daily, otherwise you may miss important information about 
      your case.
    show if: x.has_email_address      
  - Email address: users[0].email    
    datatype: email
    show if: 
      variable: users[0].has_email_address
      is: True
validation code: |
  if (not showifdef('users[0].phone_number') and \
      (users[0].has_email_address == False)):
    validation_error(word("You need to provide at least one contact method."), field="users[0].other_contact_method")
---
template: contact_info_help
subject: |
  **Why do I need to include this?**
content: |  
  The court must be able to reach you, so you need to include some contact information.
---
#Check how much space the form provides and how much can fit.
id: missed opportunities
question: |
  What opportunities have you missed because of your cannabis conviction records?
subquestion: |
  This is where you can write about how your criminal record and cannabis convictions have hurt you. If you have been denied a job or housing, you can mention that here.

  ${collapse_template(opportunities_help)}
  
  The form has space for about 24 lines of text, or about 1,350 characters. If you need more space, write it down and attach it to your Motion.
fields:
  - Missed opportunities: missed_opportunities
    input type: area
    rows: 16
    maxlength: 1350
---
template: opportunities_help
subject: |
  **How should I describe my missed opportunities?**
content: |
  Here are some examples:

  * I applied for a job in the cannabis industry and I was denied my Agent Identification Card because of my criminal record.
  * I received an offer for a job position, but after a criminal background check the offer was rescinded because of my criminal record.
  
  **If you have been denied housing due to your criminal record**, it is important for the court to know specific examples where you have been denied housing. Helpful information can include the approximate date of denial, location/name of building, and how it affected you. Here is an example:

  * In April 2020, I applied for housing with Oak Apartments in Chicago, and the manager told me they could not allow me to live there due to my criminal record. This apartment was in a good neighborhood and was affordable for my family, but we were forced to move into my sister’s home instead.

  Attach any documentation of your housing denial, which can include: a letter from the landlord or management company that denied you housing and the background check that showed your conviction.
---
template: signature_help
subject: |
  **What does it mean to sign the *Motion to Vacate and Expunge*?**
content: |  
  By signing your *Motion to Vacate and Expunge*, you are certifying that:
  
  * You read the document,
  * You believe it to be true and correct, and
  * You are not filing it for an improper purpose, such as to cause delay.

  See **[Illinois Supreme Court Rule 137](https://www.illinoiscourts.gov/supreme-court-rules)** for more information.
---
#This code block creates the list of alternate names for the template.
reconsider: True
code: |
  
  alternate_names_list.clear()
  #nested_cap is incremented whenever a qualified conviction has an alternate name. Once it hits 6, all the names the program will list have been entered and there is no need to check the remaining convictions.
  nested_cap = 0
  for person in convictions:
    if nested_cap <= 6:
      if person.qualified == True:
        if person.other_name_check == False:
          alternate_names_list.append(person.alternate_name)
          nested_cap += 1
  list_those_names = True
---
#This is similar to the code generated alternate_names_list. The difference is that this uses a while loop instead of a for loop so it can be run before the convictions list is fully gathered. I'm not certain both are necessary; I see no reason why this block couldn't also be used to generate the list of alternate names for the forms. OH! There is one issue with this one that the other one doesn't have; if a user is able to list more than six alternate names through review screen chicanery, partial_name_list can list more than 6 names but alternate_names_list will only list the first six alternate names. That could most certainly be addressed here as well, but for now I will let sleeping dogs lie.
reconsider: True
code: |
  partial_name_list.clear()
  quick_counter_ceiling = convictions.number_gathered()
  quick_counter_ceiling -= 1
  quick_counter = 0
  while quick_counter < quick_counter_ceiling:
    if convictions[quick_counter].qualified == True:
      if convictions[quick_counter].other_name_check == False:
        partial_name_list.append(convictions[i].alternate_name)
        quick_counter += 1
  make_partial_list = True
---
#This code block runs at the end of the interview, generating variables used in the templates.
reconsider: True
code: |
  #There are fields in a template where the user enters how much time has passed since their most recent conviction and their age upon their most recent arrest. arrest_time_storage and conviction_time_storage will be used to calculate that. these initial values are intended to get replaced by values based on the arrest and conviction dates from the qualified_convictions list.
  arrest_time_storage = date_difference(starting=users[0].birthdate, ending=users[0].birthdate)
  conviction_time_storage = date_difference(starting='1/1/1901', ending=today())
  #There are checkboxes to mark whether any of the convictions are a misdemeanor or a felony. These variables start as False, but will be set to true if any of the convictions are a misdemeanor or a felony, respectively.
  any_misdemeanors = False
  any_felonies = False
  #alternate_names_list.clear()
  
  #Here is our for loop. Note that we are iterating through qualified_convictions, not convictions.
  for person in qualified_convictions:
    #We want to catch the most recent arrest date and calculate the user's age at that arrest. temp_arrest_time_ref is a date_difference variable that is reset for each iteration and compared to the storage variable used in the template. If temp_arrest_time_ref is greater in years, its value will be entered into arrest_time_storage
    temp_arrest_time_ref = date_difference(starting=users[0].birthdate, ending=person.arrest_date)
    if temp_arrest_time_ref.years > arrest_time_storage.years:
      arrest_time_storage = temp_arrest_time_ref
     #We want to catch the most recent conviction date and calculate how many years have passed since. temp_conviction_time_ref is a date_difference variable that is reset for each iteration and compared to the storage variable used in the template. If temp_conviction_time_ref is lesser in years, its value will be entered into conviction_time_storage
    temp_conviction_time_ref = date_difference(starting=person.date, ending=today())
    if temp_conviction_time_ref.years < conviction_time_storage.years:
      conviction_time_storage = temp_conviction_time_ref
    #if person.other_name_check == False:
      #alternate_names_list.append(person.alternate_name.name.full(middle='full'))
    #here is where the any_misdemeanors and/or any_felonies variables will be flagged as True.
    if person.type == "misdemeanor":
      any_misdemeanors = True
    elif person.type == "felony":
      any_felonies = True
    #number_for_form is a variable that contains either just the case number or the case number & municipal number presented cleanly. As of this writing--Nov 6 2023--we are planning to check in with a SME on the language we use here.
    if person.municipal_number == "":
      person.number_for_form = person.case_number
    elif person.municipal_number != "":
      #person.number_for_form = "Case: "
      person.number_for_form = person.case_number
      #person.number_for_form += ", Municipal: "
      person.number_for_form += ", Muni: "
      person.number_for_form += person.municipal_number
  a_little_more_logic = True
---
id: get docs screen
event: get_docs_screen
question: |
  Download
subquestion: |
  Your forms are ready. View and download your forms below. Click **Make changes** to fix any mistakes.
  
  The Instructions page has important information. You can read it to find out what to do next.
  
  If you have cannabis convictions in another county, you can restart this program to make additional forms for them after downloading these forms.
  
  ${ action_button_html(url_action('review_answers'), label=':edit: Make changes', color='success', size="md") }

  ${ al_user_bundle.download_list_html() }
 
  &nbsp;

  ${ al_user_bundle.send_button_html(show_editable_checkbox=False) }
  
  **Note:** This program does **not** file your forms. You will need to do this yourself.

  Thank you for using ILAO Easy Forms!
under: |
  % if not user_logged_in():
  [${fa_icon("sign-in-alt", color="#0079d0", size="sm")} **Sign-in**](${url_of('login', next=interview_url())}) or [**create**](${url_of('register', next=interview_url())}) an ILAO Easy Form account to save your progress (optional).
  % endif

 
  ${ action_button_html(interview_url(i="docassemble.ILAO:feedback.yml", easy_form_interview=ilao_easy_form_url, easy_form_title=ilao_easy_form_title, easy_form_page=user_info().question_id, easy_form_variable=user_info().variable, local=False,reset=1), label=':comment: Was this program helpful?', color="#181c36", size="md", new_window=True) }
---
generic object: ALDocumentBundle
template: x.send_email_template
subject: |
  Cannabis expungement
content: |
  Your forms are attached.
  
  Thanks for using ILAO Easy Forms!
  
  [Illinois Legal Aid Online](https://www.illinoislegalaid.org)
---
#Reminder: set up two orders if more than 18 convictions
---
objects:
  - instructions: ALDocument.using(title="Instructions", filename="instructions.pdf", has_addendum=False)
  - motion: ALDocument.using(title="Motion to vacate and expunge", filename="motion_to_vacate.pdf", has_addendum=False)
  - notice: ALDocument.using(title="Notice of court date", filename="notice_of_court_date.pdf", has_addendum=False)
  - order: ALDocument.using(title="Order", filename="order.pdf", has_addendum=False)
  - additional_convictions: ALDocument.using(title="Additional convictions", filename="additional_convictions.pdf", has_addendum=False)
  - additional_notice: ALDocument.using(title="Additional notice", filename="additional_notice.pdf", has_addendum=False)
  - additional_order: ALDocument.using(title="Additional order", filename="additional_order.pdf", has_addendum=False)
---
code: |
  instructions.enabled = True
  motion.enabled = True
  notice.enabled = True
  order.enabled = True
  additional_convictions.enabled = False
  additional_notice.enabled = False
  additional_order.enabled = False
  
  if qualified_count_check > 18:
    additional_convictions.enabled = True
    additional_notice.enabled = True
    additional_order.enabled = True
---
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[instructions, cannabis_expungement_motion_bundle, cannabis_expungement_notice_bundle, cannabis_expungement_order_bundle], filename="cannabis_expungement.pdf", title="All forms")
  - al_court_bundle: ALDocumentBundle.using(elements=[instructions, cannabis_expungement_motion_bundle, cannabis_expungement_notice_bundle, cannabis_expungement_order_bundle], filename="cannabis_expungement.pdf", title="All forms")
---
objects:
  - cannabis_expungement_motion_bundle: ALDocumentBundle.using(elements=[motion, additional_convictions], filename="cannabis_expungement_motion_bundle.pdf", title="Motion", enabled=True)
  - cannabis_expungement_notice_bundle: ALDocumentBundle.using(elements=[notice, additional_notice], filename="cannabis_expungement_notice_bundle.pdf", title="Notice", enabled=True)
  - cannabis_expungement_order_bundle: ALDocumentBundle.using(elements=[order, additional_order], filename="cannabis_expungement_order_bundle.pdf", title="Order", enabled=True)
---
attachment:
  variable name: instructions[i]
  name: instructions
  filename: instructions
  skip undefined: True
  editable: False
  pdf template file: CXP_Instructions.pdf
  fields:
      - "fake": ${ "" }
---
attachment:
  variable name: motion[i]
  name: motion
  filename: motion
  skip undefined: True
  editable: False
  pdf template file: CXP_Motion_to_Vacate_and_Expunge.pdf
  fields:
      - "filing_county_without_county": ${filing_location.county.upper()}
      - "user_name": ${users[0].name.full(middle='full')}
      - "additional_names": ${comma_and_list(alternate_names_list.complete_elements().full_names())}
      - "new_case_number": ${new_case_number if new_number_check == True else ""}
      - "user_birth": ${users[0].birthdate}
      - "user_race": ${users[0].other_race if users[0].race == "Other" else users[0].race}
      - "user_gender": ${users[0].other_gender if users[0].gender == "Other" else users[0].gender}
      - "case_number_one": ${qualified_convictions[0].number_for_form}
      - "case_number_two": ${qualified_convictions[1].number_for_form}
      - "case_number_three": ${qualified_convictions[2].number_for_form}
      - "case_number_four": ${qualified_convictions[3].number_for_form}
      - "case_number_five": ${qualified_convictions[4].number_for_form}
      - "case_number_six": ${qualified_convictions[5].number_for_form}
      - "case_number_seven": ${qualified_convictions[6].number_for_form}
      - "case_number_eight": ${qualified_convictions[7].number_for_form}
      - "case_number_nine": ${qualified_convictions[8].number_for_form}
      - "case_number_ten": ${qualified_convictions[9].number_for_form}
      - "case_number_eleven": ${qualified_convictions[10].number_for_form}
      - "case_number_twelve": ${qualified_convictions[11].number_for_form}
      - "case_number_thirteen": ${qualified_convictions[12].number_for_form}
      - "case_number_fourteen": ${qualified_convictions[13].number_for_form}
      - "case_number_fifteen": ${qualified_convictions[14].number_for_form}
      - "case_number_sixteen": ${qualified_convictions[15].number_for_form}
      - "case_number_seventeen": ${qualified_convictions[16].number_for_form}
      - "case_number_eighteen": ${qualified_convictions[17].number_for_form}
      - "any_misdemeanors": ${any_misdemeanors}
      - "any_felonies": ${any_felonies}
      - "before_june": ${True}
      - "completed_sentences": ${True}
      - "ask_to_expunge": ${True}
      - "agency_one": ${qualified_convictions[0].agency}
      - "agency_two": ${qualified_convictions[1].agency}
      - "agency_three": ${qualified_convictions[2].agency}
      - "agency_four": ${qualified_convictions[3].agency}
      - "agency_five": ${qualified_convictions[4].agency}
      - "agency_six": ${qualified_convictions[5].agency}
      - "agency_seven": ${qualified_convictions[6].agency}
      - "agency_eight": ${qualified_convictions[7].agency}
      - "agency_nine": ${qualified_convictions[8].agency}
      - "agency_ten": ${qualified_convictions[9].agency}
      - "agency_eleven": ${qualified_convictions[10].agency}
      - "agency_twelve": ${qualified_convictions[11].agency}
      - "agency_thirteen": ${qualified_convictions[12].agency}
      - "agency_fourteen": ${qualified_convictions[13].agency}
      - "agency_fifteen": ${qualified_convictions[14].agency}
      - "agency_sixteen": ${qualified_convictions[15].agency}
      - "agency_seventeen": ${qualified_convictions[16].agency}
      - "agency_eighteen": ${qualified_convictions[17].agency}
      - "misdemeanor_one": ${True if qualified_convictions[0].type == "misdemeanor" else False}
      - "misdemeanor_two": ${True if qualified_convictions[1].type == "misdemeanor" else False}
      - "misdemeanor_three": ${True if qualified_convictions[2].type == "misdemeanor" else False}
      - "misdemeanor_four": ${True if qualified_convictions[3].type == "misdemeanor" else False}
      - "misdemeanor_five": ${True if qualified_convictions[4].type == "misdemeanor" else False}
      - "misdemeanor_six": ${True if qualified_convictions[5].type == "misdemeanor" else False}
      - "misdemeanor_seven": ${True if qualified_convictions[6].type == "misdemeanor" else False}
      - "misdemeanor_eight": ${True if qualified_convictions[7].type == "misdemeanor" else False}
      - "misdemeanor_nine": ${True if qualified_convictions[8].type == "misdemeanor" else False}
      - "misdemeanor_ten": ${True if qualified_convictions[9].type == "misdemeanor" else False}
      - "misdemeanor_eleven": ${True if qualified_convictions[10].type == "misdemeanor" else False}
      - "misdemeanor_twelve": ${True if qualified_convictions[11].type == "misdemeanor" else False}
      - "misdemeanor_thirteen": ${True if qualified_convictions[12].type == "misdemeanor" else False}
      - "misdemeanor_fourteen": ${True if qualified_convictions[13].type == "misdemeanor" else False}
      - "misdemeanor_fifteen": ${True if qualified_convictions[14].type == "misdemeanor" else False}
      - "misdemeanor_sixteen": ${True if qualified_convictions[15].type == "misdemeanor" else False}
      - "misdemeanor_seventeen": ${True if qualified_convictions[16].type == "misdemeanor" else False}
      - "misdemeanor_eighteen": ${True if qualified_convictions[17].type == "misdemeanor" else False}
      - "felony_one": ${True if qualified_convictions[0].type == "felony" else False}
      - "felony_two": ${True if qualified_convictions[1].type == "felony" else False}
      - "felony_three": ${True if qualified_convictions[2].type == "felony" else False}
      - "felony_four": ${True if qualified_convictions[3].type == "felony" else False}
      - "felony_five": ${True if qualified_convictions[4].type == "felony" else False}
      - "felony_six": ${True if qualified_convictions[5].type == "felony" else False}
      - "felony_seven": ${True if qualified_convictions[6].type == "felony" else False}
      - "felony_eight": ${True if qualified_convictions[7].type == "felony" else False}
      - "felony_nine": ${True if qualified_convictions[8].type == "felony" else False}
      - "felony_ten": ${True if qualified_convictions[9].type == "felony" else False}
      - "felony_eleven": ${True if qualified_convictions[10].type == "felony" else False}
      - "felony_twelve": ${True if qualified_convictions[11].type == "felony" else False}
      - "felony_thirteen": ${True if qualified_convictions[12].type == "felony" else False}
      - "felony_fourteen": ${True if qualified_convictions[13].type == "felony" else False}     
      - "felony_fifteen": ${True if qualified_convictions[14].type == "felony" else False}
      - "felony_sixteen": ${True if qualified_convictions[15].type == "felony" else False}
      - "felony_seventeen": ${True if qualified_convictions[16].type == "felony" else False}
      - "felony_eighteen": ${True if qualified_convictions[17].type == "felony" else False}
      - "arrest_date_one": ${qualified_convictions[0].arrest_date}
      - "arrest_date_two": ${qualified_convictions[1].arrest_date}
      - "arrest_date_three": ${qualified_convictions[2].arrest_date}
      - "arrest_date_four": ${qualified_convictions[3].arrest_date}
      - "arrest_date_five": ${qualified_convictions[4].arrest_date}
      - "arrest_date_six": ${qualified_convictions[5].arrest_date}
      - "arrest_date_seven": ${qualified_convictions[6].arrest_date}
      - "arrest_date_eight": ${qualified_convictions[7].arrest_date}
      - "arrest_date_nine": ${qualified_convictions[8].arrest_date}
      - "arrest_date_ten": ${qualified_convictions[9].arrest_date}
      - "arrest_date_eleven": ${qualified_convictions[10].arrest_date}
      - "arrest_date_twelve": ${qualified_convictions[11].arrest_date}
      - "arrest_date_thirteen": ${qualified_convictions[12].arrest_date}
      - "arrest_date_fourteen": ${qualified_convictions[13].arrest_date}
      - "arrest_date_fifteen": ${qualified_convictions[14].arrest_date}
      - "arrest_date_sixteen": ${qualified_convictions[15].arrest_date}
      - "arrest_date_seventeen": ${qualified_convictions[16].arrest_date}
      - "arrest_date_eighteen": ${qualified_convictions[17].arrest_date}
      - "additional_convictions": ${True if qualified_count_check > 18 else False}
      - "current_age": ${ users[0].age_in_years()}
      - "age_at_last_arrest": ${ int(arrest_time_storage.years)}
      - "years_since_conviction": ${int(conviction_time_storage.years) if int(conviction_time_storage.years) != 0 else ""}
      - "months_since_conviction": ${""}
      - "missed_opportunities": ${missed_opportunities}
      - "signature_date": ${ today() if e_signature == True else ""}
      - "e_signature": ${ users[0].name.full(middle='full') if e_signature == True else ""}
      - "user_street": ${ users[0].address.line_one(bare=True)}
      - "user_csz": ${users[0].address.line_two()}
      - "user_phone": ${phone_number_formatted(users[0].phone_number)}
      - "user_email": ${users[0].email if users[0].has_email_address == True else ""}   
---
attachment:
  variable name: notice[i]
  name: notice
  filename: notice
  skip undefined: True
  editable: False
  pdf template file: CXP_Notice_of_Court_Date_for_Motion.pdf
  fields:
      - "filing_county_without_county": ${filing_location.county.upper()}
      - "filing_county_without_county_lower": ${filing_location.county}
      - "user_name": ${users[0].name.full(middle='full')}
      - "fee_waiver": ${fee_waiver_check}
      - "additional_names": ${comma_and_list(alternate_names_list.complete_elements().full_names())}
      - "new_case_number": ${new_case_number if new_number_check == True else ""}
      - "user_birth": ${users[0].birthdate}
      - "user_race": ${users[0].other_race if users[0].race == "Other" else users[0].race}
      - "user_gender": ${users[0].other_gender if users[0].gender == "Other" else users[0].gender}
      - "states_attorney_address": ${states_attorney_address.on_one_line(bare=True)}
      - "case_number_one": ${qualified_convictions[0].number_for_form}
      - "case_number_two": ${qualified_convictions[1].number_for_form}
      - "case_number_three": ${qualified_convictions[2].number_for_form}
      - "case_number_four": ${qualified_convictions[3].number_for_form}
      - "case_number_five": ${qualified_convictions[4].number_for_form}
      - "case_number_six": ${qualified_convictions[5].number_for_form}
      - "case_number_seven": ${qualified_convictions[6].number_for_form}
      - "case_number_eight": ${qualified_convictions[7].number_for_form}
      - "case_number_nine": ${qualified_convictions[8].number_for_form}
      - "case_number_ten": ${qualified_convictions[9].number_for_form}
      - "case_number_eleven": ${qualified_convictions[10].number_for_form}
      - "case_number_twelve": ${qualified_convictions[11].number_for_form}
      - "case_number_thirteen": ${qualified_convictions[12].number_for_form}
      - "case_number_fourteen": ${qualified_convictions[13].number_for_form}
      - "case_number_fifteen": ${qualified_convictions[14].number_for_form}
      - "case_number_sixteen": ${qualified_convictions[15].number_for_form}
      - "case_number_seventeen": ${qualified_convictions[16].number_for_form}
      - "case_number_eighteen": ${qualified_convictions[17].number_for_form}
      - "additional_convictions": ${True if qualified_count_check > 18 else False}
      - "hearing_date": ${hearing_date if hearing_date_check == True else ""}
      - "hearing_time": ${format_time(hearing_time, format='h:mm') if hearing_date_check == True else "" }
      - "hearing_am": ${True if format_time(hearing_time, format='a')=='AM' else False}
      - "hearing_pm": ${True if format_time(hearing_time, format='a')=='PM' else False}
      - "hearing_courtroom": ${ hearing_courtroom if hearing_date_check == True else "" }
      - "hearing_address":  ${court_house_address}
      - "e_signature": ${ users[0].name.full(middle='full') if e_signature == True else ""}
      - "signature_date": ${ today() if e_signature == True else ""}
      - "user_street": ${ users[0].address.line_one(bare=True)}
      - "user_csz": ${users[0].address.line_two()}
      - "user_phone": ${phone_number_formatted(users[0].phone_number)}
      - "user_email": ${users[0].email if users[0].has_email_address == True else ""}
---
attachment:
  variable name: order[i]
  name: order
  filename: order
  skip undefined: True
  editable: False
  pdf template file: CXP_Order_Granting_or_Denying_Motion.pdf
  fields:
      - "filing_county_without_county": ${filing_location.county.upper()}
      - "user_name": ${users[0].name.full(middle='full')}
      - "additional_names": ${comma_and_list(alternate_names_list.complete_elements().full_names())}
      - "new_case_number": ${new_case_number if new_number_check == True else ""}
      - "user_birth": ${users[0].birthdate}
      - "user_race": ${users[0].other_race if users[0].race == "Other" else users[0].race}
      - "user_gender": ${users[0].other_gender if users[0].gender == "Other" else users[0].gender}
      - "case_number_one": ${qualified_convictions[0].number_for_form}
      - "case_number_two": ${qualified_convictions[1].number_for_form}
      - "case_number_three": ${qualified_convictions[2].number_for_form}
      - "case_number_four": ${qualified_convictions[3].number_for_form}
      - "case_number_five": ${qualified_convictions[4].number_for_form}
      - "case_number_six": ${qualified_convictions[5].number_for_form}
      - "case_number_seven": ${qualified_convictions[6].number_for_form}
      - "case_number_eight": ${qualified_convictions[7].number_for_form}
      - "case_number_nine": ${qualified_convictions[8].number_for_form}
      - "case_number_ten": ${qualified_convictions[9].number_for_form}
      - "case_number_eleven": ${qualified_convictions[10].number_for_form}
      - "case_number_twelve": ${qualified_convictions[11].number_for_form}
      - "case_number_thirteen": ${qualified_convictions[12].number_for_form}
      - "case_number_fourteen": ${qualified_convictions[13].number_for_form}
      - "case_number_fifteen": ${qualified_convictions[14].number_for_form}
      - "case_number_sixteen": ${qualified_convictions[15].number_for_form}
      - "case_number_seventeen": ${qualified_convictions[16].number_for_form}
      - "case_number_eighteen": ${qualified_convictions[17].number_for_form}
      - "user_address_one": ${ users[0].address.line_one(bare=True)}
      - "user_address_two": ${users[0].address.line_two()}
      - "user_phone": ${phone_number_formatted(users[0].phone_number)}
      - "user_email": ${users[0].email if users[0].has_email_address == True else ""}
---
attachment:
  variable name: additional_convictions[i]
  name: additional_convictions
  filename: additional_convictions
  skip undefined: True
  editable: False
  pdf template file: CXP_Additional_Cannabis_Convictions.pdf
  fields:
      - "filing_county_without_county": ${filing_location.county.upper()}
      - "user_name": ${users[0].name.full(middle='full')}
      - "additional_names": ${comma_and_list(alternate_names_list.complete_elements().full_names())}
      - "new_case_number": ${new_case_number if new_number_check == True else ""}
      - "user_birth": ${users[0].birthdate}
      - "user_race": ${users[0].other_race if users[0].race == "Other" else users[0].race}
      - "user_gender": ${users[0].other_gender if users[0].gender == "Other" else users[0].gender}
      - "case_number_nineteen": ${qualified_convictions[18].number_for_form}
      - "case_number_twenty": ${qualified_convictions[19].number_for_form}
      - "case_number_twentyone": ${qualified_convictions[20].number_for_form}
      - "case_number_twentytwo": ${qualified_convictions[21].number_for_form}
      - "case_number_twentythree": ${qualified_convictions[22].number_for_form}
      - "case_number_twentyfour": ${qualified_convictions[23].number_for_form}
      - "case_number_twentyfive": ${qualified_convictions[24].number_for_form}
      - "case_number_twentysix": ${qualified_convictions[25].number_for_form}
      - "case_number_twentyseven": ${qualified_convictions[26].number_for_form}
      - "case_number_twentyeight": ${qualified_convictions[27].number_for_form}
      - "case_number_twentynine": ${qualified_convictions[28].number_for_form}
      - "case_number_thirty": ${qualified_convictions[29].number_for_form}
      - "case_number_thirtyone": ${qualified_convictions[30].number_for_form}
      - "case_number_thirtytwo": ${qualified_convictions[31].number_for_form}
      - "case_number_thirtythree": ${qualified_convictions[32].number_for_form}
      - "case_number_thirtyfour": ${qualified_convictions[33].number_for_form}
      - "case_number_thirtyfive": ${qualified_convictions[34].number_for_form}
      - "case_number_thirtysix": ${qualified_convictions[35].number_for_form}
      - "ask_to_vacate": ${True}
      - "agency_nineteen": ${qualified_convictions[18].agency}
      - "agency_twenty": ${qualified_convictions[19].agency}
      - "agency_twentyone": ${qualified_convictions[20].agency}
      - "agency_twentytwo": ${qualified_convictions[21].agency}
      - "agency_twentythree": ${qualified_convictions[22].agency}
      - "agency_twentyfour": ${qualified_convictions[23].agency}
      - "agency_twentyfive": ${qualified_convictions[24].agency}
      - "agency_twentysix": ${qualified_convictions[25].agency}
      - "agency_twentyseven": ${qualified_convictions[26].agency}
      - "agency_twentyeight": ${qualified_convictions[27].agency}
      - "agency_twentynine": ${qualified_convictions[28].agency}
      - "agency_thirty": ${qualified_convictions[29].agency}
      - "agency_thirtyone": ${qualified_convictions[30].agency}
      - "agency_thirtytwo": ${qualified_convictions[31].agency}
      - "agency_thirtythree": ${qualified_convictions[32].agency}
      - "agency_thirtyfour": ${qualified_convictions[33].agency}
      - "agency_thirtyfive": ${qualified_convictions[34].agency}
      - "agency_thirtysix": ${qualified_convictions[35].agency}
      - "misdemeanor_nineteen": ${True if qualified_convictions[18].type == "misdemeanor" else False}
      - "misdemeanor_twenty": ${True if qualified_convictions[19].type == "misdemeanor" else False}
      - "misdemeanor_twentyone": ${True if qualified_convictions[20].type == "misdemeanor" else False}
      - "misdemeanor_twentytwo": ${True if qualified_convictions[21].type == "misdemeanor" else False}
      - "misdemeanor_twentythree": ${True if qualified_convictions[22].type == "misdemeanor" else False}
      - "misdemeanor_twentyfour": ${True if qualified_convictions[23].type == "misdemeanor" else False}
      - "misdemeanor_twentyfive": ${True if qualified_convictions[24].type == "misdemeanor" else False}
      - "misdemeanor_twentysix": ${True if qualified_convictions[25].type == "misdemeanor" else False}
      - "misdemeanor_twentyseven": ${True if qualified_convictions[26].type == "misdemeanor" else False}
      - "misdemeanor_twentyeight": ${True if qualified_convictions[27].type == "misdemeanor" else False}
      - "misdemeanor_twentynine": ${True if qualified_convictions[28].type == "misdemeanor" else False}
      - "misdemeanor_thirty": ${True if qualified_convictions[29].type == "misdemeanor" else False}
      - "misdemeanor_thirtyone": ${True if qualified_convictions[30].type == "misdemeanor" else False}
      - "misdemeanor_thirtytwo": ${True if qualified_convictions[31].type == "misdemeanor" else False}     
      - "misdemeanor_thirtythree": ${True if qualified_convictions[32].type == "misdemeanor" else False}
      - "misdemeanor_thirtyfour": ${True if qualified_convictions[33].type == "misdemeanor" else False}
      - "misdemeanor_thirtyfive": ${True if qualified_convictions[34].type == "misdemeanor" else False}
      - "misdemeanor_thirtysix": ${True if qualified_convictions[35].type == "misdemeanor" else False}
      - "felony_nineteen": ${True if qualified_convictions[18].type == "felony" else False}
      - "felony_twenty": ${True if qualified_convictions[19].type == "felony" else False}
      - "felony_twentyone": ${True if qualified_convictions[20].type == "felony" else False}
      - "felony_twentytwo": ${True if qualified_convictions[21].type == "felony" else False}
      - "felony_twentythree": ${True if qualified_convictions[22].type == "felony" else False}
      - "felony_twentyfour": ${True if qualified_convictions[23].type == "felony" else False}
      - "felony_twentyfive": ${True if qualified_convictions[24].type == "felony" else False}
      - "felony_twentysix": ${True if qualified_convictions[25].type == "felony" else False}
      - "felony_twentyseven": ${True if qualified_convictions[26].type == "felony" else False}
      - "felony_twentyeight": ${True if qualified_convictions[27].type == "felony" else False}
      - "felony_twentynine": ${True if qualified_convictions[28].type == "felony" else False}
      - "felony_thirty": ${True if qualified_convictions[29].type == "felony" else False}
      - "felony_thirtyone": ${True if qualified_convictions[30].type == "felony" else False}
      - "felony_thirtytwo": ${True if qualified_convictions[31].type == "felony" else False}     
      - "felony_thirtythree": ${True if qualified_convictions[32].type == "felony" else False}
      - "felony_thirtyfour": ${True if qualified_convictions[33].type == "felony" else False}
      - "felony_thirtyfive": ${True if qualified_convictions[34].type == "felony" else False}
      - "felony_thirtysix": ${True if qualified_convictions[35].type == "felony" else False}
      - "arrest_date_nineteen": ${qualified_convictions[18].arrest_date}
      - "arrest_date_twenty": ${qualified_convictions[19].arrest_date}
      - "arrest_date_twentyone": ${qualified_convictions[20].arrest_date}
      - "arrest_date_twentytwo": ${qualified_convictions[21].arrest_date}
      - "arrest_date_twentythree": ${qualified_convictions[22].arrest_date}
      - "arrest_date_twentyfour": ${qualified_convictions[23].arrest_date}
      - "arrest_date_twentyfive": ${qualified_convictions[24].arrest_date}
      - "arrest_date_twentysix": ${qualified_convictions[25].arrest_date}
      - "arrest_date_twentyseven": ${qualified_convictions[26].arrest_date}
      - "arrest_date_twentyeight": ${qualified_convictions[27].arrest_date}
      - "arrest_date_twentynine": ${qualified_convictions[28].arrest_date}
      - "arrest_date_thirty": ${qualified_convictions[29].arrest_date}
      - "arrest_date_thirtyone": ${qualified_convictions[30].arrest_date}
      - "arrest_date_thirtytwo": ${qualified_convictions[31].arrest_date}
      - "arrest_date_thirtythree": ${qualified_convictions[32].arrest_date}
      - "arrest_date_thirtyfour": ${qualified_convictions[33].arrest_date}
      - "arrest_date_thirtyfive": ${qualified_convictions[34].arrest_date}
      - "arrest_date_thirtysix": ${qualified_convictions[35].arrest_date}
      - "e_signature": ${ users[0].name.full(middle='full') if e_signature == True else ""}
      - "signature_date": ${ today() if e_signature == True else ""}
      - "user_street": ${ users[0].address.line_one(bare=True)}
      - "user_csz": ${users[0].address.line_two()}
      - "user_phone": ${phone_number_formatted(users[0].phone_number)}
      - "user_email": ${users[0].email if users[0].has_email_address == True else ""}
---
attachment:
  variable name: additional_notice[i]
  name: additional_notice
  filename: additional_notice
  skip undefined: True
  editable: False
  pdf template file: CXP_Additional_Notice_of_Court_Date.pdf
  fields:
      - "filing_county_without_county": ${filing_location.county.upper()}
      - "user_name": ${users[0].name.full(middle='full')}
      - "additional_names": ${comma_and_list(alternate_names_list.complete_elements().full_names())}
      - "new_case_number": ${new_case_number if new_number_check == True else ""}
      - "user_birth": ${users[0].birthdate}
      - "user_race": ${users[0].other_race if users[0].race == "Other" else users[0].race}
      - "user_gender": ${users[0].other_gender if users[0].gender == "Other" else users[0].gender}
      - "case_number_nineteen": ${qualified_convictions[18].number_for_form}
      - "case_number_twenty": ${qualified_convictions[19].number_for_form}
      - "case_number_twentyone": ${qualified_convictions[20].number_for_form}
      - "case_number_twentytwo": ${qualified_convictions[21].number_for_form}
      - "case_number_twentythree": ${qualified_convictions[22].number_for_form}
      - "case_number_twentyfour": ${qualified_convictions[23].number_for_form}
      - "case_number_twentyfive": ${qualified_convictions[24].number_for_form}
      - "case_number_twentysix": ${qualified_convictions[25].number_for_form}
      - "case_number_twentyseven": ${qualified_convictions[26].number_for_form}
      - "case_number_twentyeight": ${qualified_convictions[27].number_for_form}
      - "case_number_twentynine": ${qualified_convictions[28].number_for_form}
      - "case_number_thirty": ${qualified_convictions[29].number_for_form}
      - "case_number_thirtyone": ${qualified_convictions[30].number_for_form}
      - "case_number_thirtytwo": ${qualified_convictions[31].number_for_form}
      - "case_number_thirtythree": ${qualified_convictions[32].number_for_form}
      - "case_number_thirtyfour": ${qualified_convictions[33].number_for_form}
      - "case_number_thirtyfive": ${qualified_convictions[34].number_for_form}
      - "case_number_thirtysix": ${qualified_convictions[35].number_for_form}
---
attachment:
  variable name: additional_order[i]
  name: additional_order
  filename: additional_order
  skip undefined: True
  editable: False
  pdf template file: CXP_Order_Granting_or_Denying_Motion.pdf
  fields:
      - "filing_county_without_county": ${filing_location.county.upper()}
      - "user_name": ${users[0].name.full(middle='full')}
      - "additional_names": ${comma_and_list(alternate_names_list.complete_elements().full_names())}
      - "new_case_number": ${new_case_number if new_number_check == True else ""}
      - "user_birth": ${users[0].birthdate}
      - "user_race": ${users[0].other_race if users[0].race == "Other" else users[0].race}
      - "user_gender": ${users[0].other_gender if users[0].gender == "Other" else users[0].gender}
      - "case_number_one": ${qualified_convictions[18].number_for_form}
      - "case_number_two": ${qualified_convictions[19].number_for_form}
      - "case_number_three": ${qualified_convictions[20].number_for_form}
      - "case_number_four": ${qualified_convictions[21].number_for_form}
      - "case_number_five": ${qualified_convictions[22].number_for_form}
      - "case_number_six": ${qualified_convictions[23].number_for_form}
      - "case_number_seven": ${qualified_convictions[24].number_for_form}
      - "case_number_eight": ${qualified_convictions[25].number_for_form}
      - "case_number_nine": ${qualified_convictions[26].number_for_form}
      - "case_number_ten": ${qualified_convictions[27].number_for_form}
      - "case_number_eleven": ${qualified_convictions[28].number_for_form}
      - "case_number_twelve": ${qualified_convictions[29].number_for_form}
      - "case_number_thirteen": ${qualified_convictions[30].number_for_form}
      - "case_number_fourteen": ${qualified_convictions[31].number_for_form}
      - "case_number_fifteen": ${qualified_convictions[32].number_for_form}
      - "case_number_sixteen": ${qualified_convictions[33].number_for_form}
      - "case_number_seventeen": ${qualified_convictions[34].number_for_form}
      - "case_number_eighteen": ${qualified_convictions[35].number_for_form}
---
id: review screen
event: review_answers
question: |
  Review screen
subquestion: |
  Edit your answers below.
review: 
  - label: Edit
    fields:
      - filing_location.trial_court_index
      - recompute:
        - filing_location.county
    button: |
      **Which county are you filing your motion in?**
      ${end_in_county(filing_location.county)}
  - Edit: convictions.revisit
    button: |
      **Convictions: (Edit to change case numbers, dates, and types)**

      % for my_var in convictions:
        * Conviction date: ${ my_var.date }
      % endfor
  - Edit: hearing_date_check
    button: |
      **Do you know when your hearing date is?**
      ${word(yesno(hearing_date_check))}
  - Edit: hearing_date
    button: |
      **Court date:**
      ${hearing_date}, ${hearing_time}
    show if: hearing_date_check
  - Edit: cook_district
    button: |
      **Which Cook County courthouse will you file in?**
      % if cook_district == "15":
      First Municipal District, Daley Center, 50 W. Washington Street, Chicago:
      % elif cook_district == "16":
      Second Municipal District, 5600 Old Orchard Road, Skokie
      % elif cook_district == "17":
      Third Municipal District, 2121 Euclid Avenue, Rolling Meadows
      % elif cook_district == "18":
      Fourth Municipal District, 1500 Maybrook Drive, Maywood
      % elif cook_district == "19":
      Fifth Municipal District, 10220 S. 76th Avenue, Bridgeview
      % elif cook_district == "20":
      Sixth Municipal District, 16501 South Kedzie Parkway, Markham
      % elif cook_district == "22":
      George N. Leighton Criminal Court Building, 2600 S. California Avenue, Chicago
      % endif
    show if: filing_location.county == "Cook"
  - Edit: hearing_courtroom
    button: |
      **Hearing courtroom:**
      % if hearing_courtroom != "":
      ${hearing_courtroom}
      % else:
      Not entered
      % endif
    show if: hearing_date_check
  - Edit: states_attorney_address.address
    button: |
      **State's Attorney's Address:**
      % if states_attorney_address.address == "" and states_attorney_address.unit == "" and states_attorney_address.city == "" and states_attorney_address.zip == "":
      None entered
      % else:
      ${states_attorney_address.on_one_line(bare=True)}
      % endif
  - Edit: new_number_check
    button: |
      **Did the clerk give you a new case number?**
      % if new_number_check == True:
      Yes, it is ${new_case_number}
      % else:
      No
      % endif
  - Edit: fee_waiver_check
    button: |
      **Do you want to ask the court clerk to waive your fees?**
      ${word(yesno(fee_waiver_check))}
  - Edit: users[0].name.first
    button: |
      **Your name:**
      ${users[0].name.full(middle='full')}
  - Edit: users[0].birthdate
    button: |
      **Your birthdate:**
      ${users[0].birthdate}
  - Edit: users[0].race
    button: |
      **Your race:**
      % if users[0].race != "Other":
      ${users[0].race}
      % else:
      ${users[0].other_race}
      % endif
  - Edit: users[0].gender
    button: |
      **Your gender:**
      % if users[0].gender != "Other":
      ${users[0].gender}
      % else:
      ${users[0].other_gender}
      % endif
  - Edit: users[0].address.address
    button: |
      **Your address:**
      ${users[0].address.on_one_line(bare=True)}
  - Edit: users[0].has_email_address
    button: |
      **Your contact information:**
      % if users[0].phone_number != "" and users[0].has_email_address == True:
      
      * Phone number: ${phone_number_formatted(users[0].phone_number)}
      * Email address: ${users[0].email}
      % elif users[0].phone_number != "" and users[0].has_email_address == False:
      ${phone_number_formatted(users[0].phone_number)}
      % elif users[0].phone_number == "" and users[0].has_email_address == True:
      ${users[0].email}
      % endif
  - Edit: missed_opportunities
    button: |
      **What opportunities have you missed because of your convictions?**
      
      ${missed_opportunities}
  - Edit: e_signature
    button: |
      **Do you want to add your e-signature to your forms?**
      ${word(yesno(e_signature))}
---
id: convictions table
table: convictions.table
rows: convictions
columns:
  - Conviction date: |
      row_item.date if defined("row_item.date") else ""
  - Eligible for expungement?: |
     word(yesno(row_item.qualified)) if defined("row_item.qualified") else ""
  - Dates, arrest info, other names, and outcome: |
      action_button_html(url_action(row_item.attr_name("review_conviction")), label="Edit", icon="pencil-alt")
delete buttons: True
confirm: True
---
id: conviction review
continue button field: x.review_conviction
generic object: ALIndividual
question: |
  Edit information about the ${x.date} conviction
review: 
  - Edit: x.date
    button: |
      **Date of conviction:**
      ${x.date}
  - Edit: x.type
    button: |
      **Type of offense:**
      % if x.type == "misdemeanor": 
      Misdemeanor
      % elif x.type == "felony":
      Class 4 Felony
      % else:
      Other
      % endif
  - Edit: x.case_number 
    button: |
      **Court case number:**
      ${x.case_number}
    show if: x.qualified
  - Edit: x.municipal_number
    button: |
      **Municipal case number:**
      % if x.municipal_number != "":
      ${x.municipal_number}
      % else:
      None
      % endif
    show if: x.qualified
  - Edit: x.arrest_date
    button: |
      **Arrest date:**
      ${x.arrest_date}
    show if: x.qualified
  - Edit: x.agency
    button: |
      **Arresting agency:**
      ${x.agency}
    show if: x.qualified
  - Edit: x.other_name_check
    button: |
      **Was your name listed as ${users[0].name.full(middle='full')} for this conviction?**
      ${word(yesno(x.other_name_check))}
    show if: x.qualified
  - Edit: x.alternate_name.name.first
    button: |
      **What name were you convicted under?**
      ${x.alternate_name.name.full(middle='full')}
    show if: x.other_name_check == False and x.qualified == True
  - Edit: x.same_case_check
    button: |
      **Were you convicted of any additional counts in the same case?**
      ${word(yesno(x.same_case_check))}
  - Edit: x.probation_check
    button: |
      **Did you receive Court Supervision or Qualified Probation?**
      ${word(yesno(x.probation_check))}
  - Edit: x.probation_complete
    button: |
      **Did you complete your probation?**
      ${word(yesno(x.probation_complete))}
    show if: x.probation_check
  - Edit: x.sentence_check
    button: |
      **Are you still serving your sentence?**
      ${word(yesno(x.sentence_check))}
  - Edit: x.conditions_check
    button: |
      **Have you completed all conditions of your offense?**
      ${word(yesno(x.conditions_check))}
---
id: convictions review
continue button field: convictions.revisit
question: |
  Edit the information about the convictions
subquestion: |  
  ${ convictions.table }
  
 
  % if qualified_count_check < 36:
  ${ convictions.add_action() } 
  
  % endif
---
#depends on:
#  - reconsideration_containment
#This code counts the number of qualified convictions.This is used to determine whether the "additional" templates need to be enabled and whether the Add action in the convictions table should be disabled
reconsider: True
code: |
  qualified_count_check = 0
  amount_to_check = convictions.number_gathered()
  check_iteration = 0
  while check_iteration < amount_to_check:
    if convictions[check_iteration].qualified == True:
      qualified_count_check += 1
    check_iteration += 1
  counting_is_fun = True
---
#% elif qualified_convictions.number_gathered() < 3:
#${ convictions.add_action() } 
---
section: Conviction info
id: review convictions
event: section_conviction
question: |
  Conviction info
subquestion: |
  Edit your answers below.
review:
  - Edit: users[0].name.first
    button: |
      **Your name:**
      ${users[0].name.full(middle='full')}
  - label: Edit
    fields:
      - filing_location.trial_court_index
      - recompute:
        - filing_location.county
    button: |
      **Which county are you filing your motion in?**
      ${end_in_county(filing_location.county)}
  - Edit: convictions.revisit
    button: |
      **Convictions: (Edit to change case numbers, dates, and types)**

      % for my_var in convictions:
        * Conviction date: ${ my_var.date }
      % endfor
  - Edit: missed_opportunities
    button: |
      **What opportunities have you missed because of your convictions?**
      
      ${missed_opportunities}
---
section: Notice
id: review notice
event: section_notice
question: |
  Notice
subquestion: |
  Edit your answers below.
review:
  - Edit: hearing_date_check
    button: |
      **Do you know when your hearing date is?**
      ${word(yesno(hearing_date_check))}
  - Edit: hearing_date
    button: |
      **Court date:**
      ${hearing_date}, ${hearing_time}
    show if: hearing_date_check
  - Edit: cook_district
    button: |
      **Which Cook County courthouse will you file in?**
      % if cook_district == "15":
      First Municipal District, Daley Center, 50 W. Washington Street, Chicago:
      % elif cook_district == "16":
      Second Municipal District, 5600 Old Orchard Road, Skokie
      % elif cook_district == "17":
      Third Municipal District, 2121 Euclid Avenue, Rolling Meadows
      % elif cook_district == "18":
      Fourth Municipal District, 1500 Maybrook Drive, Maywood
      % elif cook_district == "19":
      Fifth Municipal District, 10220 S. 76th Avenue, Bridgeview
      % elif cook_district == "20":
      Sixth Municipal District, 16501 South Kedzie Parkway, Markham
      % elif cook_district == "22":
      George N. Leighton Criminal Court Building, 2600 S. California Avenue, Chicago
      % endif
    show if: filing_location.county == "Cook"
  - Edit: hearing_courtroom
    button: |
      **Hearing courtroom:**
      % if hearing_courtroom != "":
      ${hearing_courtroom}
      % else:
      Not entered
      % endif
    show if: hearing_date_check
  - Edit: states_attorney_address.address
    button: |
      **State's Attorney's Address:**
      % if states_attorney_address.address == "" and states_attorney_address.unit == "" and states_attorney_address.city == "" and states_attorney_address.zip == "":
      None entered
      % else:
      ${states_attorney_address.on_one_line(bare=True)}
      % endif
---
section: Filing
id: review filing
event: section_filing
question: |
  Filing
subquestion: |
  Edit your answers below.
review:
  - Edit: new_number_check
    button: |
      **Did the clerk give you a new case number?**
      % if new_number_check == True:
      Yes, it is ${new_case_number}
      % else:
      No
      % endif
  - Edit: fee_waiver_check
    button: |
      **Do you want to ask the court clerk to waive your fees?**
      ${word(yesno(fee_waiver_check))}
---
section: About you
id: review user
event: section_about_you
question: |
  Filing
subquestion: |
  Edit your answers below.
review:
  - Edit: users[0].name.first
    button: |
      **Your name:**
      ${users[0].name.full(middle='full')}
  - Edit: users[0].birthdate
    button: |
      **Your birthdate:**
      ${users[0].birthdate}
  - Edit: users[0].race
    button: |
      **Your race:**
      % if users[0].race != "Other":
      ${users[0].race}
      % else:
      ${users[0].other_race}
      % endif
  - Edit: users[0].gender
    button: |
      **Your gender:**
      % if users[0].gender != "Other":
      ${users[0].gender}
      % else:
      ${users[0].other_gender}
      % endif
  - Edit: users[0].address.address
    button: |
      **Your address:**
      ${users[0].address.on_one_line(bare=True)}
  - Edit: users[0].has_email_address
    button: |
      **Your contact information:**
      % if users[0].phone_number != "" and users[0].has_email_address == True:
      
      * Phone number: ${phone_number_formatted(users[0].phone_number)}
      * Email address: ${users[0].email}
      % elif users[0].phone_number != "" and users[0].has_email_address == False:
      ${phone_number_formatted(users[0].phone_number)}
      % elif users[0].phone_number == "" and users[0].has_email_address == True:
      ${users[0].email}
      % endif
  - Edit: missed_opportunities
    button: |
      **What opportunities have you missed because of your convictions?**
      
      ${missed_opportunities}
  - Edit: e_signature
    button: |
      **Do you want to add your e-signature to your forms?**
      ${word(yesno(e_signature))}